{
  "gateway": {
    "mode": "local",
    "bind": "lan",
    "port": 18789,
    "trustedProxies": [
      "127.0.0.1",
      "::1",
      "172.16.0.0/12",
      "10.0.0.0/8",
      "192.168.0.0/16",
      "100.64.0.0/10",
      "host.containers.internal"
    ],
    "controlUi": {
{% if active_agents | length > 0 %}
      "dangerouslyDisableDeviceAuth": true,
      "allowInsecureAuth": true,
{% else %}
      "dangerouslyDisableDeviceAuth": false,
      "allowInsecureAuth": false,
{% endif %}
      "allowedOrigins": [
        "https://{{ groups['all'][0] }}:18789",
        "https://{{ target_hostname }}:18789",
        "https://localhost:18789",
        "http://localhost:18789",
        "http://127.0.0.1:18789",
        "https://127.0.0.1:18789"
{% for agent in active_agents %}
{% for origin in agent.gateway_origins | default([]) %}
        ,"{{ origin }}"
{% endfor %}
{% endfor %}
      ]
    },
    "auth": {
      "mode": "token",
      "token": "{{ openclaw_token }}"
    }
  },
  "discovery": {
    "mdns": { "mode": "off" }
  },
  "models": {
    "mode": "merge",
    "providers": {
      "anthropic": {
        "baseUrl": "http://litellm:4000",
        "apiKey": "${ANTHROPIC_API_KEY}",
        "api": "anthropic-messages",
        "models": [
          {
            "id": "claude-opus-4-6",
            "name": "Claude Opus 4.6",
            "reasoning": false,
            "input": ["text", "image"],
            "cost": { "input": 0, "output": 0, "cacheRead": 0, "cacheWrite": 0 },
            "contextWindow": 200000,
            "maxTokens": 4096
          }
        ]
      }
    }
  },
  "channels": {
    "telegram": { "dmPolicy": "pairing" },
    "whatsapp": { "dmPolicy": "pairing" },
    "discord": { "dm": { "policy": "pairing" } },
    "signal": { "dmPolicy": "pairing" }
  },
  "agents": {
    "defaults": {
      "heartbeat": { "every": "5m" }
    },
    "list": [
      {
        "id": "files",
        "name": "FileSentry"
      },
      {
        "id": "dev",
        "name": "Coder"
      }
{% for agent in active_agents %}
      ,{
        "id": "{{ agent.id }}",
        "name": "{{ agent.name }}",
        "workspace": "{{ agent.openclaw_agent.workspace }}",
        "agentDir": "{{ agent.openclaw_agent.agentDir }}",
        "heartbeat": {{ agent.openclaw_agent.heartbeat | to_json }}
      }
{% endfor %}
    ]
  }
{% if active_agents | selectattr('bindings', 'defined') | list | length > 0 %}
  ,"bindings": [
{% set ns = namespace(first=true) %}
{% for agent in active_agents %}
{% for binding in agent.bindings | default([]) %}
{% if not ns.first %}    ,{% endif %}
    {
      "agentId": "{{ agent.id }}",
      "match": { "channel": "{{ binding.channel }}", "accountId": "{{ binding.accountId }}" }
    }
{% set ns.first = false %}
{% endfor %}
{% endfor %}
  ]
{% endif %}
}
