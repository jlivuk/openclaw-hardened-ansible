FROM node:22-slim

RUN apt-get update && apt-get install -y --no-install-recommends sqlite3 \
    && rm -rf /var/lib/apt/lists/*

RUN mkdir -p /opt/node_libs && cd /opt/node_libs && npm init -y > /dev/null 2>&1 && npm install ws @sentry/node > /dev/null 2>&1

WORKDIR /app

COPY vera-dashboard-files/ .

ENV NODE_PATH=/opt/node_libs/node_modules
ENV VERA_MEMORY_BASE=/home/node/.openclaw/workspace-vera/memory
ENV VERA_DATA_DIR=/home/node/vera-dashboard

USER node

EXPOSE 8080

CMD ["node", "server.js"]
